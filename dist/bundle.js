const board=Array.from(document.querySelectorAll(".square")),blackPieces=["♜","♞","♝","♛","♚","♟"],whitePieces=["♖","♘","♗","♕","♔","♙"],boardElement=document.querySelector(".board");let whitePiecesOnBoard=[],blackPiecesOnBoard=[],playerToMove="white",whiteActiveMovesAbortController,blackActiveMovesAbortController,movesToRemoveBackground=[],lastChoosenSquare;function removeBackground(){null!==lastChoosenSquare&&void 0!==lastChoosenSquare&&lastChoosenSquare.htmlElement.classList.remove("choosen-piece"),movesToRemoveBackground.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active"),e.htmlElement.classList.remove("with-piece")})}let whiteKingIndex=60,blackKingIndex=4;function createSquares(){let t=-1;return board.map(e=>({htmlElement:e,index:++t,color:e.classList[1],row:Math.floor(Math.abs(Math.floor(t/8)-8)),column:String.fromCharCode(97+t%8)}))}const squares=createSquares();function getText(e){return squares[e].htmlElement.children[0].innerText}function setText(e,t){e.htmlElement.children[0].innerText=t}const isBetween=(e,t,s)=>e<s&&s<t;function calculateAllMoves(e){let t=new Set;return"white"===e?whitePiecesOnBoard.forEach(e=>{("♙"!==e.piece?e.calculateMoves():e.calculateDiagonal()).forEach(e=>t.add(e))}):blackPiecesOnBoard.forEach(e=>{("♟"!==e.piece?e.calculateMoves():e.calculateDiagonal()).forEach(e=>t.add(e))}),Array.from(t)}function areThereAnyMoves(e){if("white"===e){for(let e=0;e<whitePiecesOnBoard.length;e++)if(0<whitePiecesOnBoard[e].verifyMoves().length)return!0}else for(let e=0;e<blackPiecesOnBoard.length;e++)if(0<blackPiecesOnBoard[e].verifyMoves().length)return!0;return!1}function isBlackKingChecked(){return!!calculateAllMoves("white").includes(squares[blackKingIndex])&&(squares[blackKingIndex].htmlElement.classList.add("checked"),!0)}function isBlackKingMatedOrStalemate(){(isBlackKingChecked()&&!areThereAnyMoves("black")?(popupContent.innerText="White just checkmated Black!",handlePopup):areThereAnyMoves("black")?checkDraw:(popupContent.innerText="Stalemate!",handlePopup))()}function isWhiteKingChecked(){return!!calculateAllMoves("black").includes(squares[whiteKingIndex])&&(squares[whiteKingIndex].htmlElement.classList.add("checked"),!0)}function isWhiteKingMatedOrStalemate(){(isWhiteKingChecked()&&!areThereAnyMoves("white")?(popupContent.innerText="Black just checkmated White!",handlePopup):areThereAnyMoves("white")?checkDraw:(popupContent.innerText="Stalemate!",handlePopup))()}function handleDraw(){popupContent.innerText="Draw!",setTimeout(handlePopup,500)}function checkDraw(){var e=whitePiecesOnBoard.length,t=blackPiecesOnBoard.length;if(!(4<e+t||2<e||2<t)){if(e+t!==2)return t+e===4?isSameColorBishopRemained()?void handleDraw():void 0:void(isKingVsKingAndMinorPiece()&&handleDraw());handleDraw()}}function isSameColorBishopRemained(){var e=whitePiecesOnBoard.find(e=>"♗"===e.piece),t=blackPiecesOnBoard.find(e=>"♝"===e.piece);return!!(e&&t&&(e.htmlElement.classList.contains("black")&&t.htmlElement.classList.contains("black")||e.htmlElement.classList.contains("white")&&t.htmlElement.classList.contains("white")))}function isKingVsKingAndMinorPiece(){var e=whitePiecesOnBoard.length,t=blackPiecesOnBoard.length;return!(1!==t||2!==e||!whitePiecesOnBoard.some(e=>"♗"===e.piece||"♘"===e.piece))||!(1!==e||2!==t||!blackPiecesOnBoard.some(e=>"♞"===e.piece||"♝"===e.piece))}const background=document.querySelector(".background"),closeButton=document.querySelector(".close-button"),popup=document.querySelector(".popup"),popupContent=document.querySelector(".content");function handlePopup(){popup.classList.toggle("active"),boardElement.classList.toggle("nonactive"),background.classList.toggle("transparent")}closeButton.addEventListener("click",()=>{location.reload()});class WhiteBishop{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♗",this.addListener()}calculateUpLeftOrDownRight(e){var t=[],s=this.index;let i="up-left"===e?s-9:s+9;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return blackPieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-left"===e?i-=9:i+=9}}calculateUpRightOrDownLeft(e){var t=[],s=this.index;let i="up-right"===e?s-7:s+7;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return blackPieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-right"===e?i-=7:i+=7}}calculateMoves(){return[...this.calculateUpLeftOrDownRight("up-left"),...this.calculateUpLeftOrDownRight("down-right"),...this.calculateUpRightOrDownLeft("up-right"),...this.calculateUpRightOrDownLeft("down-left")]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort(),removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece");const s=new AbortController,i=(whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhiteBishop(squares[58]),new WhiteBishop(squares[61]));class WhiteKing{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♔",this.isMoved=!1,this.addListener()}calculateCastleH(){var e=whitePiecesOnBoard.find(e=>63===e.index&&"♖"===e.piece&&!1===e.isMoved);return!0===this.isMoved||!e||isWhiteKingChecked()||""!==getText(61)||""!==getText(62)||(e=calculateAllMoves("black")).includes(squares[61])||e.includes(squares[62])?[]:[squares[62]]}calculateCastleA(){var e=whitePiecesOnBoard.find(e=>56===e.index&&"♖"===e.piece&&!1===e.isMoved);return!0===this.isMoved||!e||isWhiteKingChecked()||""!==getText(59)||""!==getText(58)||""!==getText(57)||(e=calculateAllMoves("black")).includes(squares[59])||e.includes(squares[58])?[]:[squares[58]]}calculateMoves(){const e=this.index;return[e-1,e+1,e-7,e+7,e-8,e+8,e-9,e+9].filter(t=>!(!isBetween(-1,64,t)||whitePieces.some(e=>e===getText(t)))&&(t===e-1||t===e+1?squares[t].row===squares[e].row:t===e-7||t===e+7?squares[t].row!==squares[e].row:t!==e-9&&t!==e+9||1===Math.abs(squares[t].row-squares[e].row))).map(e=>squares[e])}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;whiteKingIndex=(""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),whiteKingIndex=t.index,calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),whiteKingIndex=t.index,calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e]),this.index)}),[...i,...this.calculateCastleA(),...this.calculateCastleH()]}handleCastle(e){if(2===Math.abs(e.index-this.index))if(62===e.index){setText(squares[63],"");const t=squares[63].htmlElement.cloneNode(!0);squares[63].htmlElement.replaceWith(t),squares[63].htmlElement=t,void(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>63!==e.index)).push(new WhiteRook(squares[61]))}else{setText(squares[56],"");const t=squares[56].htmlElement.cloneNode(!0);squares[56].htmlElement.replaceWith(t),squares[56].htmlElement=t,(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>56!==e.index)).push(new WhiteRook(squares[59]))}}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{this.isMoved=!0,squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,this.handleCastle(t),setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),whiteKingIndex=this.index,playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhiteKing(squares[60]));class WhiteKnight{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♘",this.addListener()}calculateMoves(){const e=this.index,s=[];return squares.forEach(t=>{whitePieces.some(e=>e===getText(t.index))||(1===Math.abs(t.column.charCodeAt(0)-squares[e].column.charCodeAt(0))&&2===Math.abs(t.row-squares[e].row)||2===Math.abs(t.column.charCodeAt(0)-squares[e].column.charCodeAt(0))&&1===Math.abs(t.row-squares[e].row))&&s.push(t)}),s}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhiteKnight(squares[57]),new WhiteKnight(squares[62]));class WhitePawn{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♙",this.addListener()}calculateFront(){var e=this.index;return""!==getText(e-8)?[]:!(48<=e&&e<=55)||""!==getText(e-16)?[squares[e-8]]:[squares[e-8],squares[e-16]]}calculateDiagonal(){const t=this.index;var e=[];return isBetween(-1,64,t-7)&&blackPieces.some(e=>e===getText(t-7)&&squares[t-7].row!==squares[t].row)&&e.push(squares[t-7]),isBetween(-1,64,t-9)&&blackPieces.some(e=>e===getText(t-9))&&1===Math.abs(squares[t].row-squares[t-9].row)&&e.push(squares[t-9]),e}calculateMoves(){return[...this.calculateFront(),...this.calculateDiagonal()]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e])}),i}handleQueenTransform(e){const t=this.index;setText(squares[t],"");var s=squares[t].htmlElement.cloneNode(!0);squares[t].htmlElement.replaceWith(s),squares[t].htmlElement=s,(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.index!==t)).push(new WhiteQueen(squares[e.index]))}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort(),removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece");const s=new AbortController,i=(whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,8===t.row?this.handleQueenTransform(t):(setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),this.addListener()),playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhitePawn(squares[48]),new WhitePawn(squares[49]),new WhitePawn(squares[50]),new WhitePawn(squares[51]),new WhitePawn(squares[52]),new WhitePawn(squares[53]),new WhitePawn(squares[54]),new WhitePawn(squares[55]));class WhiteQueen{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♕",this.addListener()}calculateLeftOrRight(e){var t=[];let s="left"===e?this.index-1:this.index+1;for(;;){if(!isBetween(-1,64,s)||squares[s].row!==squares[this.index].row)return t;if(""!==getText(s))return blackPieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"left"===e?s--:s++}}calculateUpOrDown(e){var t=[];let s="up"===e?this.index-8:this.index+8;for(;;){if(!isBetween(-1,64,s))return t;if(""!==getText(s))return blackPieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"up"===e?s-=8:s+=8}}calculateUpLeftOrDownRight(e){var t=[],s=this.index;let i="up-left"===e?s-9:s+9;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return blackPieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-left"===e?i-=9:i+=9}}calculateUpRightOrDownLeft(e){var t=[],s=this.index;let i="up-right"===e?s-7:s+7;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return blackPieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-right"===e?i-=7:i+=7}}calculateBishopMoves(){return[...this.calculateUpLeftOrDownRight("up-left"),...this.calculateUpLeftOrDownRight("down-right"),...this.calculateUpRightOrDownLeft("up-right"),...this.calculateUpRightOrDownLeft("down-left")]}calculateRookMoves(){return[...this.calculateLeftOrRight("left"),...this.calculateLeftOrRight("right"),...this.calculateUpOrDown("up"),...this.calculateUpOrDown("down")]}calculateMoves(){return[...this.calculateBishopMoves(),...this.calculateRookMoves()]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhiteQueen(squares[59]));class WhiteRook{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♖",this.isMoved=!1,this.addListener()}calculateLeftOrRight(e){var t=[];let s="left"===e?this.index-1:this.index+1;for(;;){if(!isBetween(-1,64,s)||squares[s].row!==squares[this.index].row)return t;if(""!==getText(s))return blackPieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"left"===e?s--:s++}}calculateUpOrDown(e){var t=[];let s="up"===e?this.index-8:this.index+8;for(;;){if(!isBetween(-1,64,s))return t;if(""!==getText(s))return blackPieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"up"===e?s-=8:s+=8}}calculateMoves(){return[...this.calculateLeftOrRight("left"),...this.calculateLeftOrRight("right"),...this.calculateUpOrDown("up"),...this.calculateUpOrDown("down")]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...blackPiecesOnBoard],blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("black").includes(squares[whiteKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),blackPiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("white"===playerToMove){whiteActiveMovesAbortController&&whiteActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),whiteActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[whiteKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),this.isMoved=!0,""!==getText(t.index)&&(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="black",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isBlackKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}whitePiecesOnBoard.push(new WhiteRook(squares[56]),new WhiteRook(squares[63]));class BlackBishop{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♝",this.addListener()}calculateUpLeftOrDownRight(e){var t=[],s=this.index;let i="up-left"===e?s-9:s+9;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return whitePieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-left"===e?i-=9:i+=9}}calculateUpRightOrDownLeft(e){var t=[],s=this.index;let i="up-right"===e?s-7:s+7;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return whitePieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-right"===e?i-=7:i+=7}}calculateMoves(){return[...this.calculateUpLeftOrDownRight("up-left"),...this.calculateUpLeftOrDownRight("down-right"),...this.calculateUpRightOrDownLeft("up-right"),...this.calculateUpRightOrDownLeft("down-left")]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackBishop(squares[2]),new BlackBishop(squares[5]));class BlackKing{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♚",this.isMoved=!1,this.addListener()}calculateCastleH(){var e=blackPiecesOnBoard.find(e=>7===e.index&&"♜"===e.piece&&!1===e.isMoved);return!0===this.isMoved||!e||isBlackKingChecked()||""!==getText(5)||""!==getText(6)||(e=calculateAllMoves("white")).includes(squares[5])||e.includes(squares[6])?[]:[squares[6]]}calculateCastleA(){var e=blackPiecesOnBoard.find(e=>0===e.index&&"♜"===e.piece&&!1===e.isMoved);return!0===this.isMoved||!e||isBlackKingChecked()||""!==getText(1)||""!==getText(2)||""!==getText(3)||(e=calculateAllMoves("white")).includes(squares[2])||e.includes(squares[3])?[]:[squares[2]]}calculateMoves(){const e=this.index;return[e-1,e+1,e-7,e+7,e-8,e+8,e-9,e+9].filter(t=>!(!isBetween(-1,64,t)||blackPieces.some(e=>e===getText(t)))&&(t===e-1||t===e+1?squares[t].row===squares[e].row:t===e-7||t===e+7?squares[t].row!==squares[e].row:t!==e-9&&t!==e+9||1===Math.abs(squares[t].row-squares[e].row))).map(e=>squares[e])}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;blackKingIndex=(""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),blackKingIndex=t.index,calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),blackKingIndex=t.index,calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e]),this.index)}),[...i,...this.calculateCastleA(),...this.calculateCastleH()]}handleCastle(e){if(2===Math.abs(e.index-this.index))if(6===e.index){setText(squares[7],"");const t=squares[7].htmlElement.cloneNode(!0);squares[7].htmlElement.replaceWith(t),squares[7].htmlElement=t,void(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>7!==e.index)).push(new BlackRook(squares[5]))}else{setText(squares[0],"");const t=squares[0].htmlElement.cloneNode(!0);squares[0].htmlElement.replaceWith(t),squares[0].htmlElement=t,(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>0!==e.index)).push(new BlackRook(squares[3]))}}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{this.isMoved=!0,squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,this.handleCastle(t),setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),blackKingIndex=this.index,playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackKing(squares[4]));class BlackKnight{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♞",this.addListener()}calculateMoves(){const e=this.index,s=[];return squares.forEach(t=>{blackPieces.some(e=>e===getText(t.index))||(1===Math.abs(t.column.charCodeAt(0)-squares[e].column.charCodeAt(0))&&2===Math.abs(t.row-squares[e].row)||2===Math.abs(t.column.charCodeAt(0)-squares[e].column.charCodeAt(0))&&1===Math.abs(t.row-squares[e].row))&&s.push(t)}),s}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackKnight(squares[1]),new BlackKnight(squares[6]));class BlackPawn{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♟",this.addListener()}calculateFront(){var e=this.index;return""!==getText(e+8)?[]:!(8<=e&&e<=15)||""!==getText(e+16)?[squares[e+8]]:[squares[e+8],squares[e+16]]}calculateDiagonal(){const t=this.index;var e=[];return isBetween(-1,64,t+7)&&whitePieces.some(e=>e===getText(t+7)&&squares[t+7].row!==squares[t].row)&&e.push(squares[t+7]),isBetween(-1,64,t+9)&&whitePieces.some(e=>e===getText(t+9))&&1===Math.abs(squares[t].row-squares[t+9].row)&&e.push(squares[t+9]),e}calculateMoves(){return[...this.calculateFront(),...this.calculateDiagonal()]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e])}),i}handleQueenTransform(e){const t=this.index;setText(squares[t],"");var s=squares[t].htmlElement.cloneNode(!0);squares[t].htmlElement.replaceWith(s),squares[t].htmlElement=s,(blackPiecesOnBoard=blackPiecesOnBoard.filter(e=>e.index!==t)).push(new BlackQueen(squares[e.index]))}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,1===t.row?this.handleQueenTransform(t):(setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),this.addListener()),playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackPawn(squares[8]),new BlackPawn(squares[9]),new BlackPawn(squares[10]),new BlackPawn(squares[11]),new BlackPawn(squares[12]),new BlackPawn(squares[13]),new BlackPawn(squares[14]),new BlackPawn(squares[15]));class BlackQueen{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♛",this.addListener()}calculateLeftOrRight(e){var t=[];let s="left"===e?this.index-1:this.index+1;for(;;){if(!isBetween(-1,64,s)||squares[s].row!==squares[this.index].row)return t;if(""!==getText(s))return whitePieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"left"===e?s--:s++}}calculateUpOrDown(e){var t=[];let s="up"===e?this.index-8:this.index+8;for(;;){if(!isBetween(-1,64,s))return t;if(""!==getText(s))return whitePieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"up"===e?s-=8:s+=8}}calculateUpLeftOrDownRight(e){var t=[],s=this.index;let i="up-left"===e?s-9:s+9;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return whitePieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-left"===e?i-=9:i+=9}}calculateUpRightOrDownLeft(e){var t=[],s=this.index;let i="up-right"===e?s-7:s+7;for(;;){if(!isBetween(-1,64,i))return t;if(Math.abs(squares[s].column.charCodeAt(0)-squares[i].column.charCodeAt(0))!==Math.abs(squares[s].row-squares[i].row));else{if(""!==getText(i))return whitePieces.some(e=>e===getText(i))?[...t,squares[i]]:t;t.push(squares[i])}"up-right"===e?i-=7:i+=7}}calculateBishopMoves(){return[...this.calculateUpLeftOrDownRight("up-left"),...this.calculateUpLeftOrDownRight("down-right"),...this.calculateUpRightOrDownLeft("up-right"),...this.calculateUpRightOrDownLeft("down-left")]}calculateRookMoves(){return[...this.calculateLeftOrRight("left"),...this.calculateLeftOrRight("right"),...this.calculateUpOrDown("up"),...this.calculateUpOrDown("down")]}calculateMoves(){return[...this.calculateBishopMoves(),...this.calculateRookMoves()]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackQueen(squares[3]));class BlackRook{constructor(e){this.htmlElement=e.htmlElement,this.index=e.index;e=this.htmlElement.children[0];this.piece=e.innerText="♜",this.isMoved=!1,this.addListener()}calculateLeftOrRight(e){var t=[];let s="left"===e?this.index-1:this.index+1;for(;;){if(!isBetween(-1,64,s)||squares[s].row!==squares[this.index].row)return t;if(""!==getText(s))return whitePieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"left"===e?s--:s++}}calculateUpOrDown(e){var t=[];let s="up"===e?this.index-8:this.index+8;for(;;){if(!isBetween(-1,64,s))return t;if(""!==getText(s))return whitePieces.some(e=>e===getText(s))?[...t,squares[s]]:t;t.push(squares[s]),"up"===e?s-=8:s+=8}}calculateMoves(){return[...this.calculateLeftOrRight("left"),...this.calculateLeftOrRight("right"),...this.calculateUpOrDown("up"),...this.calculateUpOrDown("down")]}verifyMoves(){var e=this.calculateMoves();let i=[];return e.forEach(t=>{var e,s;""===getText(t.index)?(setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,""),setText(squares[this.index],this.piece)):(e=[...whitePiecesOnBoard],whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement),s=getText(t.index),setText(t,this.piece),setText(squares[this.index],""),calculateAllMoves("white").includes(squares[blackKingIndex])||i.push(t),setText(t,s),setText(squares[this.index],this.piece),whitePiecesOnBoard=[...e])}),i}addListener(){const l=new AbortController;this.htmlElement.addEventListener("click",()=>{if("black"===playerToMove){blackActiveMovesAbortController&&blackActiveMovesAbortController.abort();const s=new AbortController,i=(removeBackground(),lastChoosenSquare=squares[this.index],this.htmlElement.classList.add("choosen-piece"),blackActiveMovesAbortController=s,this.verifyMoves());movesToRemoveBackground=[...i],i.forEach(t=>{""===getText(t.index)?t.htmlElement.lastElementChild.classList.add("active"):(t.htmlElement.lastElementChild.classList.add("active","with-piece"),t.htmlElement.classList.add("with-piece")),t.htmlElement.addEventListener("click",()=>{squares[blackKingIndex].htmlElement.classList.remove("checked"),this.htmlElement.classList.remove("choosen-piece"),this.isMoved=!0,""!==getText(t.index)&&(whitePiecesOnBoard=whitePiecesOnBoard.filter(e=>e.htmlElement!==t.htmlElement));var e=t.htmlElement.cloneNode(!0);t.htmlElement.replaceWith(e),t.htmlElement=e,setText(squares[this.index],""),this.htmlElement=t.htmlElement,this.index=t.index,setText(t,this.piece),playerToMove="white",l.abort(),s.abort(),i.forEach(e=>{e.htmlElement.lastElementChild.classList.remove("active","with-piece"),e.htmlElement.classList.remove("with-piece")}),this.addListener(),isWhiteKingMatedOrStalemate()},{signal:s.signal})})}},{signal:l.signal})}}blackPiecesOnBoard.push(new BlackRook(squares[0]),new BlackRook(squares[7]));